<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>A4ç²¾ç¢ºç‰ˆ-15é¡Œä¹å®®æ ¼ç·´ç¿’å–®</title>
    <style>
        /* A4 ç‰©ç†è¦æ ¼å®šç¾© */
        @page { 
            size: A4; 
            margin: 0; 
        }
        @media print {
            .no-print { display: none !important; }
            body { background: white !important; padding: 0 !important; }
            .worksheet { 
                box-shadow: none !important; 
                border: none !important; 
                margin: 0 auto !important;
                height: 297mm !important; /* å¼·åˆ¶ A4 é«˜åº¦ */
                page-break-after: avoid;
            }
            .grid-cell { border: 1.5pt solid #000 !important; }
            .line-row { border-bottom: 3.5pt solid #000 !important; }
            .ans-cell { color: #000 !important; }
        }

        body {
            font-family: "Noto Sans TC", sans-serif;
            background-color: #e9ecef;
            display: flex; flex-direction: column; align-items: center;
            padding: 5px; margin: 0;
        }

        .control-panel {
            background: #fff; padding: 10px 20px; border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 5px;
            display: flex; gap: 15px; align-items: center; font-size: 14px;
        }

        /* ç·´ç¿’å–® A4 æ¡†ç·šå®¹å™¨ */
        .worksheet {
            background: white; 
            width: 210mm; 
            height: 297mm;
            padding: 8mm 12mm; /* é©åº¦ç•™ç™½é˜²æ­¢è¢«å°è¡¨æ©Ÿå¤¾ç´™å€åˆ‡åˆ° */
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* é˜²æ­¢æº¢å‡ºè§¸ç™¼ç¬¬äºŒé  */
        }

        .header {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 2px solid #000; padding-bottom: 5px; margin-bottom: 15px;
            height: 40px; /* å›ºå®šæ¨™é¡Œé«˜åº¦ */
        }

        /* 15é¡Œç¶²æ ¼ï¼š3æ¬„5åˆ— */
        #mainGrid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 8mm 5mm; /* ç‰©ç†é–“è·è¨­å®š */
            flex-grow: 1;
        }

        .problem-container { display: flex; flex-direction: column; align-items: center; }
        .problem-label { font-size: 14px; margin-bottom: 2px; align-self: flex-start; font-weight: bold; }

        /* 3x3 æ–¹æ ¼ - å°ºå¯¸å¾®èª¿ä»¥ç¬¦åˆé«˜åº¦é™åˆ¶ */
        .math-3x3 {
            display: grid;
            grid-template-columns: repeat(3, 48px); 
            grid-template-rows: repeat(3, 48px);    
            border: 1.5px solid #000;
        }

        .grid-cell {
            border: 0.5px solid #000;
            display: flex; justify-content: center; align-items: center;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 40px; /* ç•¥å¾®ç¸®å°ä»¥ç¬¦åˆ 48px æ ¼å­ */
            box-sizing: border-box;
        }

        /* åŠ ç²—ç­‰æ–¼ç·š */
        .line-row { border-bottom: 4px solid #000; }

        .ans-cell { color: transparent; }
        .show-answer .ans-cell { color: #d9534f; }

        select, button { padding: 5px 10px; cursor: pointer; }
        .btn-gen { background: #007bff; color: white; border: none; border-radius: 4px; }
    </style>
</head>
<body>

    <div class="control-panel no-print">
        <label>é¡Œå‹ï¼š
            <select id="calcType">
                <option value="2plus2">äºŒä½æ•¸ + äºŒä½æ•¸</option>
                <option value="2plus1">äºŒä½æ•¸ + ä¸€ä½æ•¸</option>
            </select>
        </label>
        <label><input type="checkbox" id="allowCarry" checked> å¼·åˆ¶é€²ä½</label>
        <button onclick="generate()" class="btn-gen">åˆ·æ–° 15 é¡Œ</button>
        <button onclick="toggleAnswer()" style="background:#6c757d; color:white; border:none; border-radius:4px;">ğŸ‘ï¸ é¡¯ç¤ºç­”æ¡ˆ</button>
        <button onclick="window.print()" style="background:#28a745; color:white; border:none; border-radius:4px;">ğŸ–¨ï¸ ç›´æ¥åˆ—å° (A4)</button>
    </div>

    <div class="worksheet" id="sheet">
        <div class="header">
            <h2 style="margin:0; font-size:22px;">ç›´å¼åŠ æ³•ç·´ç¿’ (15é¡Œæ–¹æ ¼ç‰ˆ)</h2>
            <div style="font-size:14px;">å§“åï¼š________________ æ—¥æœŸï¼š____/____/____</div>
        </div>
        <div id="mainGrid"></div>
    </div>

    <script>
        function generate() {
            const type = document.getElementById('calcType').value;
            const allowCarry = document.getElementById('allowCarry').checked;
            const grid = document.getElementById('mainGrid');
            grid.innerHTML = '';

            for (let i = 1; i <= 15; i++) {
                let a, b, ans;
                let valid = false;

                while (!valid) {
                    a = Math.floor(Math.random() * 80) + 10;
                    b = (type === '2plus1') ? (Math.floor(Math.random() * 9) + 1) : (Math.floor(Math.random() * 80) + 10);
                    ans = a + b;
                    const onesSum = (a % 10) + (b % 10);
                    if (ans < 100) {
                        if (allowCarry && onesSum >= 10) valid = true;
                        if (!allowCarry && onesSum < 10) valid = true;
                    }
                }

                const a10 = Math.floor(a / 10), a1 = a % 10;
                const b10 = (type === '2plus1') ? "" : Math.floor(b / 10), b1 = b % 10;
                const ans10 = Math.floor(ans / 10), ans1 = ans % 10;

                const container = document.createElement('div');
                container.className = 'problem-container';
                container.innerHTML = `
                    <div class="problem-label">(${i})</div>
                    <div class="math-3x3">
                        <div class="grid-cell"></div><div class="grid-cell">${a10}</div><div class="grid-cell">${a1}</div>
                        <div class="grid-cell line-row">+</div><div class="grid-cell line-row">${b10}</div><div class="grid-cell line-row">${b1}</div>
                        <div class="grid-cell ans-cell"></div><div class="grid-cell ans-cell">${ans10}</div><div class="grid-cell ans-cell">${ans1}</div>
                    </div>
                `;
                grid.appendChild(container);
            }
        }
        function toggleAnswer() { document.getElementById('sheet').classList.toggle('show-answer'); }
        generate();
    </script>
</body>
</html>
